<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rosenbrock Method · ClimaTimeSteppers</title><meta name="title" content="Rosenbrock Method · ClimaTimeSteppers"/><meta property="og:title" content="Rosenbrock Method · ClimaTimeSteppers"/><meta property="twitter:title" content="Rosenbrock Method · ClimaTimeSteppers"/><meta name="description" content="Documentation for ClimaTimeSteppers."/><meta property="og:description" content="Documentation for ClimaTimeSteppers."/><meta property="twitter:description" content="Documentation for ClimaTimeSteppers."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ClimaTimeSteppers</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">ClimaTimeSteppers.jl</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Algorithm Formulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ode_solvers/">ODE Solvers</a></li><li><a class="tocitem" href="../newtons_method/">Newtons Method</a></li><li class="is-active"><a class="tocitem" href>Rosenbrock Method</a><ul class="internal"><li><a class="tocitem" href="#Introduction-to-the-formalism"><span>Introduction to the formalism</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li></ul></li><li><a class="tocitem" href="../lsrk/">Old LSRK Formulations</a></li><li><a class="tocitem" href="../mrrk/">Old MRRK Formulations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Test problems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../test_problems/">Test problems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/diffusion/">A full example on how to use ClimaTimesteppers with ClimaCore</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/ode_solvers/">ODE Solvers</a></li><li><a class="tocitem" href="../../api/newtons_method/">Newtons Method</a></li><li><a class="tocitem" href="../../api/callbacks/">Callbacks</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../dev/types/">Types</a></li><li><a class="tocitem" href="../../dev/report_gen/">Report generator</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Algorithm Formulations</a></li><li class="is-active"><a href>Rosenbrock Method</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rosenbrock Method</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaTimeSteppers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaTimeSteppers.jl/blob/main/docs/src/algorithm_formulations/rosenbrock.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Rosenbrock-methods"><a class="docs-heading-anchor" href="#Rosenbrock-methods">Rosenbrock methods</a><a id="Rosenbrock-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Rosenbrock-methods" title="Permalink"></a></h1><p>In this page, we introduce Rosenbrock-type methods to solve ordinary differential equations. In doing do, we roughly follow Chapter IV.7 of &quot;Solving Ordinary Differential Equations II&quot; by Hairer and Wanner. (Beware, notation is not the same.). In this spirit, let us introduce the need for Rosenbrock-type methods in the same way as Hairer and Wanner, by quoting Rosenbrock himself:</p><blockquote><p>When the functions are non-linear, implicit equations can in general be solved only by iteration. This is a severe drawback, as it adds to the problem of stability, that of convergence of the iterative process. An alternative, which avoids this difficulty, is ...</p></blockquote><p>Rosenbrock method!</p><p>Before reading this page, we recommend reading the page on ODE solvers first [TODO: Add link]</p><h2 id="Introduction-to-the-formalism"><a class="docs-heading-anchor" href="#Introduction-to-the-formalism">Introduction to the formalism</a><a id="Introduction-to-the-formalism-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-the-formalism" title="Permalink"></a></h2><p>Let us consider an ordinary differential equation of the form</p><p class="math-container">\[\frac{d}{dt}u(t) = T(u(t), t)\,,\]</p><p>where <span>$u$</span> is the state, <span>$T$</span> is the tendency, and <span>$t$</span> the time. For the sake of simplicity, let us ignore the explicit time dependency in the tendency (we will get back to that at the end).</p><p>The simplest way to introduce the Rosenbrock method is to start from a diagonally implicit Runge-Kutta scheme (see page on DIRK). In an implicit Runge-Kutta method with <span>$s$</span> stages and tableau <span>$a, b, c$</span>, the updated value <span>$u_1$</span> for a step of size <span>$\Delta t$</span> is obtained starting from the known value <span>$u_0$</span> with</p><p class="math-container">\[u_1 = u_0 + \sum_{i=1}^s b_i k_i\,,\]</p><p>with</p><p class="math-container">\[k_i = \Delta t  T ( u_0 + \sum_{j=1}^{i-1}\alpha_{ij}k_j + \alpha_{ii} k_i)\,.\]</p><p class="math-container">\[\alpha_{ij}\]</p><p>, <span>$b_i$</span> are carefully chosen coefficients.</p><p>Rosenbrock&#39;s idea consists in linearizing <span>$T$</span>. This operation can be interpreted as taking one iteration for Netwon solver and yields</p><p class="math-container">\[k_i = \Delta t T(g_i) + \Delta t T&#39;(g_i) \alpha_{ii} k_i\]</p><p>with <span>$J(g_i)$</span> Jacobian of the tendency and with</p><p class="math-container">\[g_i = u_0 + \sum_{j=1}^{i-1}\alpha_{ij} k_j\]</p><p>In Rosenbrock-type methods, the Jacobian <span>$T&#39;$</span> is replaced with linear combinations of the Jacobian evaluated at <span>$u_0$</span>, <span>$J$</span>:</p><p class="math-container">\[T&#39;(g_i) \alpha_{ii} k_i \approx J \sum_{j=1}^{i-1}\gamma_{ij} k_j + J \gamma_{ii} k_i\,,\]</p><p>with <span>$\gamma_{ij}$</span> other coefficients that can be chosen.</p><p>Now, each stage consists of solving a system of linear equations in <span>$k_i$</span> with matrix <span>$I - \Delta t \gamma_{ii}$</span>:</p><p class="math-container">\[(I - J \Delta t \gamma_{ii}) k_i = \Delta
t T(g_i) + J \sum_{j=1}^{i-1}\gamma_{ij} k_j\]</p><p>for each <span>$i$</span> in <span>$1, \dots, s$</span>. Once <span>$k_i$</span> are known, <span>$u_1$</span> can is easily computed and the process repeated for the next step.</p><p>In practice, there are computational advantages at implementing a slight variation of what presented here.</p><p>Let us define <span>$\tilde{k}_{i} = \sum_{j=1}^{i} \gamma_{ij} k_j$</span>. If the matrix <span>$\gamma_{ij}$</span> is invertible, we can move freely from <span>$k_i$</span> to <span>$\tilde{k}_i$</span>. A convenient step is to also define <span>$C$</span>, as</p><p class="math-container">\[C = diag(\gamma_{11}^{-1}, \gamma_{22}^{-1}, \dots, \gamma_{ss}^{-1}) - \Gamma^{-1}\]</p><p>Which establishes that</p><p class="math-container">\[k_i = \frac{\tilde{k}_i}{\gamma_{ii}} - \sum_{j=1}^{i -1} c_{ij} \tilde{k}_j\]</p><p>Substituting this, we obtain the following equations</p><p class="math-container">\[(J \Delta t \gamma_{ii} - 1) \tilde{k}_i = - \Delta
t \gamma_{ii} T(g_i) - \gamma_{ii} J \sum_{j=1}^{i-1}c_{ij} \tilde{k}_j \,,\]</p><p class="math-container">\[g_i =  u_0 + \sum_{j=1}^{i-1}a_{ij} \tilde{k}_j \,,\]</p><p class="math-container">\[u_1 = u_0 + \sum_{j=1}^{s} m_j \tilde{k}_j\,,\]</p><p>with</p><p class="math-container">\[(a_{ij}) = (\alpha_{ij}) \Gamma^{-1}\,,\]</p><p>and</p><p class="math-container">\[(m_i) = (b_i) \Gamma^{-1}\]</p><p>Finally, small changes are required to add support for explicit time derivative:</p><p class="math-container">\[(J \Delta t \gamma_{ii} - 1) \tilde{k}_i = - \Delta
t \gamma_{ii} T( t_0 + \alpha_i \Delta t,  g_i) - \gamma_{ii} J \sum_{j=1}^{i-1}c_{ij} \tilde{k}_j - \Delta
t \gamma_{ii} \gamma_i \Delta
t \frac{\partial T}{\partial t}(t_0, u_0)\]</p><p>where we defined</p><p class="math-container">\[\alpha_{i} = \sum_{j=1}^{i-1}\alpha_{ij} $

$ \gamma _{i} = \sum_{j=1}^{i}\gamma_{ij} $

&gt; :note: You may wonder, what is up with all these ugly minus signs? Why don&#39;t
&gt; we cancel them out? The reason for this is because we want to have the
&gt; prefactor $(J \Delta t \gamma_{ii} - 1)\]</p><p>. This is called <code>Wfact</code> in the</p><blockquote><p>language of <code>DifferentialEquations.jl</code>. Most other algorithms specify this quantity, so it is convenient to be consistent.</p></blockquote><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><p>In <code>ClimaTimeSteppers.jl</code>, we implement the last equation presented in the previous section. Currently, the only Rosenbrock-type algorithm implemented is <code>SSPKnoth</code>. <code>SSPKnoth</code> is 3-stage, second-order accurate Rosenbrock with</p><p class="math-container">\[\alpha = \begin{bmatrix}
    0 &amp; 0 &amp; 0 \\
    1 &amp; 0 &amp; 0 \\
    \frac{1}{4} &amp; \frac{1}{4} &amp; 0 \\
    \end{bmatrix}\]</p><p class="math-container">\[\Gamma = \begin{bmatrix}
    1 &amp; 0 &amp; 0 \\
    1 &amp; 1 &amp; 0 \\
    -\frac{3}{4} &amp; \frac{3}{4} &amp; 1 \\
    \end{bmatrix}\]</p><p>and</p><p class="math-container">\[b = (\frac{1}{6}, \frac{1}{6}, \frac{2}{3})\]</p><p>At each stage, the state is updated to <span>$g_i$</span> and precomputed quantities are updated. Tendencies are computed and, unless the stage is the last, DSS is applied to the sum of all the tendencies. After the last stage, DSS is applied to the incremented state.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../newtons_method/">« Newtons Method</a><a class="docs-footer-nextpage" href="../lsrk/">Old LSRK Formulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Thursday 12 September 2024 19:43">Thursday 12 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
